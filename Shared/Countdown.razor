@inject TimerService TimerService
@implements IDisposable

<MudText Typo="Typo.subtitle2">@_remaining</MudText>

@code {
    [EditorRequired][Parameter] public required ulong Seconds { get; set; }
    [Parameter] public bool Increasing { get; set; }

    private string _remaining = string.Empty;

    protected override void OnInitialized()
    {
        TimerService.OnTick += HandleTick;
        UpdateDisplay();
    }

    private void HandleTick()
    {
        TimerService.RequestUpdate(UpdateDisplay);
    }

    private void UpdateDisplay()
    {
        _remaining = CalculateRemaining();
        StateHasChanged();
    }

    private string CalculateRemaining()
    {
        if (Seconds == 0 && !Increasing)
            return string.Empty;

        var timeUntil = DateTime.UnixEpoch.AddSeconds(Seconds);
        var remaining = Increasing
            ? DateTime.UtcNow - timeUntil
            : timeUntil - DateTime.UtcNow;

        return remaining < TimeSpan.Zero && !Increasing
            ? string.Empty
            : remaining.ToString(@"dd\.hh\:mm\:ss");
    }

    public void Dispose()
    {
        TimerService.OnTick -= HandleTick;
    }
}
